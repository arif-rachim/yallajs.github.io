{"version":3,"sources":["yalla.js"],"names":[],"mappings":"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","file":"yalla-compiled.js","sourcesContent":["const isTextNode = el => el.nodeType === 3;\r\nconst isAttributeNode = el => el.nodeType === 2;\r\nconst itIsNotInitialized = node => !node.yallaTemplate;\r\nconst isMinimizationAttribute = node => { return ['checked','compact','declare','defer','disabled','ismap',\r\n        'noresize','noshade','nowrap','selected'].indexOf(node.nodeName) >= 0;};\r\n\r\nconst DATA_SEPARATOR = 'â†­';\r\nconst SEPARATOR = `<!--${DATA_SEPARATOR}-->`;\r\n\r\n\r\n\r\nclass HtmlTemplate {\r\n    constructor(string = [], values = []) {\r\n        this.templateStatics = string;\r\n        this.templateStaticString = string.join(SEPARATOR);\r\n        this.templateValues = values;\r\n    }\r\n\r\n    buildNodeTree() {\r\n        let el = document.createElement('div');\r\n        let innerHtml = this.templateStaticString;\r\n        el.innerHTML = innerHtml;\r\n        this.nodeTree = Array.from(el.childNodes);\r\n        return this;\r\n    }\r\n\r\n    lookupDynamicNodes(nodes = this.nodeTree, results = []) {\r\n        if(!nodes){\r\n            throw new Error('nodeTree does not exist in HtmlTemplate probably you need to call buildNodeTree');\r\n        }\r\n        this.dynamicNodes = nodes.reduce((results, node) => {\r\n            if(node instanceof Comment && node.textContent == DATA_SEPARATOR){\r\n                results.push(node);\r\n            }\r\n            if (node.attributes) {\r\n                Array.from(node.attributes).reduce((results, attribute) => {\r\n                    if(attribute.nodeValue.indexOf(SEPARATOR) >= 0){\r\n                        results.push(attribute);\r\n                    }\r\n                    return results;\r\n                }, results);\r\n                this.lookupDynamicNodes(Array.from(node.childNodes), results);\r\n            }\r\n            return results;\r\n        }, results);\r\n        return this;\r\n    }\r\n\r\n    appendSiblingFrom(node) {\r\n        this.nodeTree.forEach(n => {\r\n            return node.parentElement.insertBefore(n, node);\r\n        });\r\n        return this;\r\n    }\r\n\r\n    appendChildrenTo(node) {\r\n        this.nodeTree.forEach(n => node.appendChild(n));\r\n        return this;\r\n    }\r\n\r\n    applyValues(templateValues = this.templateValues) {\r\n        this.dynamicNodes.reduce((templateValues, dynamicNode, index) => {\r\n            let value = templateValues[index];\r\n            HtmlTemplate._applyValue(dynamicNode, value);\r\n            return templateValues;\r\n        }, templateValues);\r\n        return this;\r\n    }\r\n\r\n    static _applyValue(node, value) {\r\n        if(isAttributeNode(node)){\r\n            HtmlTemplate._applyAttributeNode(node,value);\r\n        }else{\r\n            HtmlTemplate._applyComponentNode(node,value);\r\n        }\r\n    }\r\n\r\n    saveTemplateToNode(node){\r\n        node.yallaTemplate = this;\r\n    }\r\n\r\n    static _applyComponentNode(node, value) {\r\n        value = value || '';\r\n        if(value instanceof HtmlTemplate){\r\n            if(itIsNotInitialized(node)){\r\n                value.buildNodeTree().lookupDynamicNodes().appendSiblingFrom(node).applyValues().saveTemplateToNode(node);\r\n            }else{\r\n                if(node.yallaTemplate instanceof HtmlTemplate){\r\n                    if(node.yallaTemplate.templateStaticString == value.templateStaticString){\r\n                        node.yallaTemplate.applyValues(value.templateValues);\r\n                    }else{\r\n                        node.yallaTemplate.destroy();\r\n                        node.yallaTemplate = value.buildNodeTree().lookupDynamicNodes().appendSiblingFrom(node).applyValues();\r\n                    }\r\n                }else{\r\n                    node.parentElement().removeChild(node.yallaTemplate);\r\n                    node.yallaTemplate = value.buildNodeTree().lookupDynamicNodes().appendSiblingFrom(node).applyValues();\r\n                }\r\n\r\n            }\r\n        }else if(value instanceof HtmlTemplateCollections){\r\n            if(itIsNotInitialized(node)){\r\n                value.initializeCollections(node);\r\n            }else{\r\n                if(node.yallaTemplate instanceof HtmlTemplateCollections){\r\n                    node.yallaTemplate.applyValues(value);\r\n                }else{\r\n                    throw new Error('You seems to have different template !!');\r\n                }\r\n            }\r\n        }else {\r\n            HtmlTemplate._applyTextToNode(value, node);\r\n        }\r\n    }\r\n\r\n    static _applyTextToNode(value, node) {\r\n        value = value || '';\r\n        let text = document.createTextNode(value.toString());\r\n        if (node.yallaTemplate && isTextNode(node.yallaTemplate)) {\r\n            node.parentElement.removeChild(node.yallaTemplate);\r\n        }\r\n        node.parentElement.insertBefore(text,node);\r\n        node.yallaTemplate = text;\r\n    }\r\n\r\n    static _applyAttributeNode(node, value) {\r\n        if (typeof value === 'function' && node.name.indexOf('on') === 0) {\r\n            node.nodeValue = DATA_SEPARATOR;\r\n            node.ownerElement[node.name] = value;\r\n        }else{\r\n            if(!node.valueOriginal){\r\n                node.valueOriginal = node.value;\r\n            }\r\n            if(node.value.indexOf(SEPARATOR)<0){\r\n                node.value = node.valueOriginal;\r\n            }\r\n            if(isMinimizationAttribute(node)){\r\n                node.ownerElement[node.nodeName] = value;\r\n            }else{\r\n                node.value = node.value.split(SEPARATOR).reduce((result,data,index)=>{\r\n                    return index == 0 ? data : `${result}${index == 1 ? value : SEPARATOR}${data}`;\r\n                },'');\r\n            }\r\n        }\r\n    }\r\n\r\n    destroy(){\r\n        this.nodeTree.forEach(n => n.parentElement.removeChild(n));\r\n    }\r\n}\r\n\r\nclass HtmlTemplateCollections{\r\n    constructor(keyFunction,mapFunction,source){\r\n        this.dictionary = {};\r\n        this.keyFunction = keyFunction;\r\n        this.mapFunction = mapFunction;\r\n        this.keyOrders = [];\r\n        source.reduce(function(token,item,index,source){\r\n            let {templateCollections,keyFunction,mapFunction,orders} = token;\r\n            let key = keyFunction.apply(token.templateCollections,[item,index,source]);\r\n            templateCollections.dictionary[key] = mapFunction.apply(templateCollections,[item,index,source]);\r\n            orders.push(key);\r\n            return token;\r\n        },{\r\n            templateCollections : this,\r\n            keyFunction : this.keyFunction,\r\n            mapFunction : this.mapFunction,\r\n            orders : this.keyOrders\r\n        });\r\n    }\r\n\r\n    initializeCollections(node){\r\n        this.keyOrders.forEach(key =>{\r\n            let v = this.dictionary[key];\r\n            v.buildNodeTree().lookupDynamicNodes().appendSiblingFrom(node).applyValues();\r\n        });\r\n        node.yallaTemplate = this;\r\n        this.node = node;\r\n    }\r\n\r\n    applyValues(newTemplateCollections){\r\n        this.keyOrders.filter(key => newTemplateCollections.keyOrders.indexOf(key) < 0).forEach(key => {\r\n           this.keyOrders.splice(this.keyOrders.indexOf(key),1);\r\n            let dict = this.dictionary;\r\n            dict[key].destroy();\r\n            delete dict[key];\r\n        });\r\n\r\n        newTemplateCollections.keyOrders.reduceRight((token,key) => {\r\n            let {currentDict,newDict,node} = token;\r\n            let dict = newDict[key];\r\n\r\n            if(key in currentDict){\r\n                dict = currentDict[key];\r\n                dict.applyValues(newDict[key].templateValues);\r\n                if(dict.nodeTree[dict.nodeTree.length-1].nextSibling != node){\r\n                    dict.nodeTree.forEach(n => node.parentElement.insertBefore(n,node));\r\n                }\r\n                token.node = dict.nodeTree[0];\r\n                newDict[key] = dict;\r\n            }else{\r\n                dict.buildNodeTree().lookupDynamicNodes().appendSiblingFrom(node).applyValues();\r\n            }\r\n            token.node = dict.nodeTree[0];\r\n            return token;\r\n        },{\r\n            currentDict : this.dictionary,\r\n            newDict: newTemplateCollections.dictionary,\r\n            keyOrderPos : this.keyOrders.map(function(key){\r\n                return {key : key, pos : newTemplateCollections.keyOrders.indexOf(key)};\r\n            }).sort((a,b) => a.pos - b.pos ),\r\n            node : this.node\r\n        });\r\n\r\n        this.dictionary = newTemplateCollections.dictionary;\r\n        this.keyOrders = newTemplateCollections.keyOrders;\r\n    }\r\n\r\n}\r\n\r\nfunction htmlMap(source,keyFunction,mapFunction){\r\n    let keyFunc = typeof keyFunction === 'string' ? i => i[keyFunction] : keyFunction;\r\n    if(typeof keyFunc !== 'function'){\r\n        throw new Error('Please provide keyFunction in htmlMap')\r\n    }\r\n    return new HtmlTemplateCollections(keyFunc,mapFunction,source);\r\n}\r\n\r\nfunction html(string, ...values) {\r\n    return new HtmlTemplate(string, values);\r\n}\r\n\r\nfunction render(htmlTemplate, rootNode) {\r\n    if (!rootNode || !htmlTemplate) {\r\n        console.error('render(htmlTemplate,node) : htmlTemplate and node are mandatory');\r\n    }\r\n    let {yallaTemplate} = rootNode;\r\n    if (!yallaTemplate) {\r\n        htmlTemplate\r\n            .buildNodeTree()\r\n            .lookupDynamicNodes()\r\n            .appendChildrenTo(rootNode)\r\n            .applyValues().saveTemplateToNode(rootNode);\r\n    } else {\r\n        rootNode.yallaTemplate.applyValues(htmlTemplate.templateValues)\r\n    }\r\n}\r\n"]}